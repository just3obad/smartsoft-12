<script type="text/javascript" charset="utf-8">
  //This is a method that will be called on viewing this page it gets the data 
  //that will be added to the graph + what's the start
  //point and also what is the interval between each two points default will be 
  //1 day also it takes the names of the things it
  //view across time by default for a story we will view no of shares, 
  //no of likes, no of dislikes and no of spams
  //and then call method Graph that will view the graph with the parameters 
  //already stated.
   
  //Also this method gets the start date of data flow from get_story_start_date 
  //method in StoriesHelper.

  $(document).ready(function() {
      //get The story's array of arrays of data
      data= <%= @story.get_story_stat %>;
      //the graphs that we want to show
      names=["No Of Shares","No Of Likes","No of Dislikes","No of Flags","No of Comments"]; 
      //the time interval between one point and another in the graph.
      pointInterval= <%= 1.day * 1000 %> ;
      // Start point of the graph.
      start_date = 
      <%= @story.get_story_start_date.to_i %>;
      //check if the story was deleted before the last 30 days
      //if no, then render the graph normally. If yes, 
      //then show the warning described in the HTML part below
      if(start_date != -1) {
      pointStart= 
      <%= @story.get_story_start_date.days.ago.to_i * 1000 %>
      //Label for x-axis
      xl="Day"; 
      yl="Number";
      titleOfGraph="Story Statistics";
      document.getElementById("deletedStory").style.display = "none";
      document.getElementById("graphTitle").style.display = "block";
      //call the method that renders the graph with the calculated parameters.
      Graph(data,names,pointInterval,pointStart,xl,yl,titleOfGraph); 
      } else {
      document.getElementById("ccc").style.display = "none";
      document.getElementById("graphTitle").style.display = "none";
      document.getElementById("deletedStory").style.display = "block";
      }  
   likes= <%= @story.likedislikes.where(action: 1).count %>;
   dislikes = <%= @story.likedislikes.where(action: -1).count %>;
   total = likes + dislikes;
   if(total == 0) {
     	document.getElementById("progressbar").style.display = "none";
   } else {
        document.getElementById("progressbar").style.display = "block";
   }
   });
   
</script>
<div class="container-fluid maindiv">
	<div id="graphTitle" style="display: none; margin-left: 30px;"> 
    	<h1>Graph</h1></div>
    	<div class="alert" id="deletedStory" style="display: none;">
        <h1><strong>Warning!</strong> Story was hidden before the last 30 days.
        </h1>
     	</div>
    	<!-- ccc is the id of the div that the graph would render to -->
	<div class="border-graph" id="ccc" style="width: 1230px; margin-left: 30px;">
	</div>
	<div class="row-fluid">
		<div class="statistics-left-panel " id="graph">
			<ul class="nav nav-list">	
				
			<li class="divider"></li>
			<div class="statistics-page-well">
				<div class="accordion-inner">
					<h3 class="statistics-component-text">
Likes/Dislikes : <%= @story.likedislikes.where(action: 1).count %> 
/ <%= @story.likedislikes.where(action: -1).count %></h3> 
	<div class="progresscustom" id="progressbar" style="display: none;">
	 <div class="barcustom" id="barofprogress" 
	 	style="width: <%= get_width %>%"></div>
				</div>						      					<h3 class="statistics-component-text">
			Number of Flags : <%= @story.flags.count %>
			<% if @story.flags.count == 1 %>
			<%= "Flag" %>
			<% else %>
			<%= "Flags"  %>
			<%  end %>
				</h3>
				<h3 class="statistics-component-text">
			Number of Shares : <%= @story.shares.count %>
			<% if @story.shares.count == 1 %>
			<%= "Share" %>
			<% else %>
			<%= "Shares"  %>
			<%  end %>
				</h3>
				<h3 class="statistics-component-text">
			Number of Comments : <%= @story.comments.count %>
			<% if @story.comments.count == 1 %>
			<%= "Comment" %>
			<% else %>
			<%= "Comments"  %>
			<%  end %>
				</h3>
					</div>
				</div>
	<h3 class="statistics-component-text">Story</h3>
		<li class="divider"></li>
		<div class="well-story-component ">
		<a href="/stories/<%= @id%>"
				class="thumbnail-story-component">
			<%= image_tag "logo.jpeg", :size => "75x75" %></a>
		  	<div class="story-component-info">
				<h2><% if @story.title.nil? %>
					   <%= "No Title Available" %>
					   <% else %>
					   <%= @story.title  %>
					   <%  end %></h2>					
				</div>
		</div>
	<h3 class="statistics-component-text">Interest related</h3>
		<li class="divider"></li>
		<div class="well-interest-component">
			<a href="/interests/<%= @story.interest_id%>"
				class="thumbnail-interest-component">
			  <% if @story.interest.image.nil? || @story.interest.image == "" %>
     			  <%= image_tag "logo.jpeg", :size => "75x75" %>
     			  <% else %>
            <img src= "<%= @story.interest.image %>" width="75" style="height:75px"/>
            		  <% end %> </a>
				<div class="interest-component-info">
					<h2><% if @story.interest.name.nil? %>
						<%= "No Name Available" %>
						<% else %>
						<%= @story.interest.name  %>
						<%  end %>
					</h2>
<%= link_to "view Statistics", 
{:controller => 'statistics', :action => 'interests',:id => @story.interest_id }, 
class: "interest-component-button-absolute btn btn-primary"%>

				</div>
		</div>
			</ul>
	 </div>
	 <div class="statistics-right-panel ">
<ul class="nav nav-list">
		
	
	<h3 class="statistics-component-text">
	<% if @story.sharers.uniq.count == 0 %>
	 	<%= "This story was not shared by anyone" %>
	<% elsif @story.sharers.uniq.count == 1 %>
		Shared by <%= @story.sharers.uniq.count %>
		<%= "user" %>
	<% else %>
		Shared by <%= @story.sharers.uniq.count %>
		<%= "users"  %>
	<%  end %></h3>
	
	<li class="divider"></li>
	<% if @story.sharers.uniq.count != 0 %>
	<div class="pre-scrollable-statistics">
<% @story.shares.select("distinct(user_id)").find_each do |share| %>
		<div class="well-user-component">
		<a href="/users/<%= share.user_id%>"class="thumbnail-user-component">
		<% if User.find(share.user_id).image.nil? || 
			User.find(share.user_id).image == "" %>
     		  <%= image_tag "logo.jpeg", :size => "75x75" %>
     		  <% else %>
		  <img src= "<%= User.find(share.user_id).image %>" 
		  	width="75" style="height:75px"/>
            	  <% end %> </a>
			<div class="user-component-info">
			  <h3><%= User.find(share.user_id).email %>
			  <h6>
			  (
			  <%= @story.sharers.where(id: share.user_id).count %>
			  <% if @story.sharers.where(id: share.user_id).count == 1 %>
			  <%= "Share" %>
			  <% else %>
			  <%= "Shares"  %>
			  <%  end %>
			  )
			  </h6>
			  </h3>
<%= link_to "view Statistics", 
{:controller => 'statistics', :action => 'users', :id => share.user_id}, 
class: "user-component-button-absolute btn btn-primary"%>
			</div>
		</div>
		<% end %>
	</div>
	<% end %>
			
					
</ul>
</div>
</div>
</div>

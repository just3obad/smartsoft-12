<script type="text/javascript" charset="utf-8">
  //This is a method that will be called on viewing this page it gets the data that will be added to the graph + what's the start
   //point and also what is the interval between each two points default will be 1 day also it takes the names of the things it
   //view across time by default for a story we will view no of shares , no of likes, no of dislikes and no of spams
   //and then call method Graph that will view the graph with the parameters already stated.
   
   //also this method gets the start date of data flow from get_story_start_date method in StoriesHelper

  $(document).ready(function() {
      //get The story's array of arrays of data
      data= <%= get_story_stat(@id) %>
      //the graphs that we want to show
      names=["No Of Shares","No Of Likes","No of Dislikes","No of Flags"]; 
      //the time interval between one point and another in the graph.
      pointInterval= <%= 1.day * 1000 %> 
      // Start point of the graph.
      x = <%= get_story_start_date(@id).to_i %>;
      //check if the story was deleted before the last 30 days
      //if no, then render the graph normally. if yes, then show the warning described in the HTML part below
      if(x != -1) {
      pointStart= <%= get_story_start_date(@id).days.ago.to_i * 1000 %>
      //Label for x-axis
      xl="Day"; 
      yl="Number";
      titleOfGraph="Story Stat";
      document.getElementById("deletedStory").style.display= "none"; 
      document.getElementById("backButtonWarning").style.display = "none";
      //call the method that renders the graph with the calculated parameters.
      Graph(data,names,pointInterval,pointStart,xl,yl,titleOfGraph); 
      } else {
      document.getElementById("deletedStory").style.display = "block";
      document.getElementById("backButtonWarning").style.display = "block";
      document.getElementById("graph").style.display = "none";
      document.getElementById("backButton").style.display = "none";
      }  
   });
</script>

  <div class="row-fluid">
  
   <!--This warning will appear only if the given story was deleted before the last 30 days so that the admin knows that there are no graphs for this story:-->
   
   <div class="span12">
   <div id= "backButtonWarning" style="display: none;">
      <%= link_to "Back to the stories page", {:controller => 'stories', :action => 'show', :id => @id}, class: "btn btn-large btn-primary" %>
      </div>
      <br/>
      <br/>
     <div class="alert" id="deletedStory" style="display: none;">
  
           <a class="close" data-dismiss="alert">Ã—</a>
           <h1><strong>Warning!</strong> Story was deleted before the last 30 days.</h1>
     </div>
    <div class = "row-fluid">
      <!--That's the content of the sidebar:-->
      <div class="span4" id = "Sidebar">
       
       <div id= "backButton">
      <%= link_to "Back to the stories page", {:controller => 'stories', :action => 'show', :id => @id}, class: "btn btn-large btn-primary" %>
      <br/>
      <br/>
      </div>
       
       <div class="well sidebar-nav">
            
            <!--Here we'll get the number shares, likes, dislikes and spams of the given story:-->
            <h4><div class="alert alert-info">
            Number of shares:
            </div></h4>
            <h4>
            <%= get_total_number_of_shares(@id) %>
            </h4>
            <br />
            
            <h4><div class="alert alert-info">
            Number of likes:
            </div></h4>
            <h4>
            <%= get_total_number_of_likes(@id) %>
            </h4>
            <br />
            
            <h4><div class="alert alert-info">
            Number of dislikes:
            </div></h4>
            <h4>
            <%= get_total_number_of_dislikes(@id) %>
            </h4>
            <br />
            
            <h4><div class="alert alert-info">
            Number of spams:
            </div></h4>
            <h4>
            <%= get_total_number_of_flags(@id) %>
            </h4>
            <br />
            
            <h4><div class="alert alert-info">
            This story belongs to the following Interest:
            </div></h4>
            <h4>
            <%= get_interest_of_story(@id) %>
            </h4>
            <br />
            
            <!--Here we'll get the users who shared the given story with a link to the profile page of each user:-->
            <h4><div class="alert alert-info">
            Users who shared this story:
            </div></h4>
            <% Share.where(:story_id => @id).find_each do |share| %>
            <%= link_to User.find(share.user_id).email, {:controller => 'users', :action => 'show', :id => share.user_id}, class: "btn btn-large btn-primary" %>
            <br />
            <% end %>
              
          </div>
      
    </div>
    <!--The content of the right side of the page:-->
    <div class="span8">
      
     <!-- ccc is the id of the div that the graph would render to -->
      <div class="hero-unit" id="graph">
      <div id="ccc"></div>
         
      </div>
    </div>
   </div>
 </div>
</div>

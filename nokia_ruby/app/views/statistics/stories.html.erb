<script type="text/javascript" charset="utf-8">
  //This is a method that will be called on viewing this page it gets the data that will be added to the graph + what's the start
   //point and also what is the interval between each two points default will be 1 day also it takes the names of the things it
   //view across time by default for a story we will view no of shares , no of likes, no of dislikes and no of spams
   //and then call method Graph that will view the graph with the parameters already stated.
   
   //also this method gets the start date of data flow from get_story_start_date method in StoriesHelper

  $(document).ready(function() {
      //get The story's array of arrays of data
      data= <%= get_story_stat(@id) %>
      //the graphs that we want to show
      names=["No Of Shares","No Of Likes","No of Dislikes","No of Flags"]; 
      //the time interval between one point and another in the graph.
      pointInterval= <%= 1.day * 1000 %> 
      // Start point of the graph.
      start_date = <%= get_story_start_date(@id).to_i %>
      //check if the story was deleted before the last 30 days
      //if no, then render the graph normally. if yes, then show the warning described in the HTML part below
      if(start_date != 1) {
      pointStart= <%= get_story_start_date(@id).days.ago.to_i * 1000 %>
      //Label for x-axis
      xl="Day"; 
      yl="Number";
      titleOfGraph="Story Stat";
      document.getElementById("deletedStory").style.display = "none";
      //call the method that renders the graph with the calculated parameters.
      Graph(data,names,pointInterval,pointStart,xl,yl,titleOfGraph); 
      } else {
      document.getElementById("ccc").style.display = "none";
      document.getElementById("graphTitle").style.display = "none";
      document.getElementById("deletedStory").style.display = "block";
      }  
       likes= <%= get_total_number_of_likes(@id) %>;
   dislikes = <%= get_total_number_of_dislikes(@id) %>;
   total = likes + dislikes;
   if(total == 0) {
     	document.getElementById("progressbar").style.display = "none";
   } else {
        document.getElementById("progressbar").style.display = "block";
   }
   });
   
</script>
<div class="container-fluid maindiv">
	<div id="graphTitle" style="display: none;"> 
    	<h1>Graph</h1></div>
    	<div class="alert" id="deletedStory" style="display: none;">
           <a class="close" data-dismiss="alert">Ã—</a>
           <h1><strong>Warning!</strong> Story was hidden before the last 30 days.</h1>
     	</div>
    	<!-- ccc is the id of the div that the graph would render to -->
	<div class= "border-graph" id="ccc">
	</div>
	<div class="row-fluid">
		<div class="statistics-left-panel " id="graph">
			<ul class="nav nav-list">	
				
			<li class="divider"></li>
			<div class="statistics-page-well">
				<div class="accordion-inner">
					<h3 class="statistics-component-text">
		Likes/Dislikes :<%= get_total_number_of_likes(@id) %> , <%= get_total_number_of_dislikes(@id) %></h3> 
				<div class="progresscustom" id="progressbar" style="display: none;">
					<div class="barcustom" id="barofprogress" style="width: <%= getWidth(@id)%>%"></div>
				</div>						      					<h3 class="statistics-component-text">
			Number of Flags : <%= get_total_number_of_likes(@id) %> Flags
				</h3>
				<h3 class="statistics-component-text">
			Number of Shares : <%= get_total_number_of_shares(@id) %> Shares
				</h3>
					</div>
				</div>
	<h3 class="statistics-component-text">Story</h3>
		<li class="divider"></li>
		<div class="well-story-component ">
				<a href="#"class="thumbnail-story-component"><img src="http://placehold.it/75x75" /></a>
				<div class="story-component-info">
						<h3><% if @story.title.nil? %>
						   <%= "No Title" %>
						   <% else %>
						   <%= @story.title  %>
						   <%  end %>
						</h3>
					    <%=	link_to "Go to story main Page", {:controller => 'stories', :action => 'show',:id => @id }, class: "story-component-button-absolute btn btn-primary"%>

				</div>
		</div>
	<h3 class="statistics-component-text">Interest related</h3>
		<li class="divider"></li>
		<div class="well-interest-component">
				<a href="#"class="thumbnail-interest-component"><img src="http://placehold.it/75x75" /></a>
				<div class="interest-component-info">
						<h3><% if @interest.name.nil? %>
						   <%= "No Name" %>
						   <% else %>
						   <%= @interest.name  %>
						   <%  end %>
						</h3>
						<h6><% if @interest.description.nil? %>
						   <%= "No Description " %>
						   <% else %>
						   <%= @interest.description  %>
						   <%  end %>
						</h6>
					    <%=	link_to "Go to Interest main Page", {:controller => 'interests', :action => 'show',:id => @interest_id }, class: "interest-component-button-absolute btn btn-primary"%>

				</div>
		</div>
			</ul>
	 </div>
	 <div class="statistics-right-panel ">
<ul class="nav nav-list">
		
	
	<h3 class="statistics-component-text">Shared by <%= get_distinct_number_of_users_who_shared(@id) %> 
	<% if get_distinct_number_of_users_who_shared(@id) == 1 %>
	<%= "user" %>
	<% else %>
	<%= "users"  %>
	<%  end %></h3>
	
	<li class="divider"></li>
	<div class="pre-scrollable-statistics"><% Share.where(:story_id => @id).select("distinct(user_id)").find_each do |share| %>
		<div class="well-user-component">
		<a href="/users/<%= @id%>"class="thumbnail-user-component"><img src="http://placehold.it/75x75" /></a>
			<div class="user-component-info">
				<h3><%= User.find(share.user_id).email %></h3>
						<%= link_to "view Statistics", {:controller => 'users', :action => 'show', :id => share.user_id}, class: "user-component-button-absolute btn btn-primary"%>
			</div>
		</div>
		<% end %>
	</div>
			
					
</ul>
</div>
</div>
</div>

<html>
<!-- adding story title-->
<% if @story == nil %>
 <div align="center">
 <%= " the selected story was removed ! "%> </br></br>
 			   <%= link_to image_tag("http://icons.iconarchive.com/icons/dryicons/simplistica/128/back-icon.png" , :style =>"width:50px;height:30px;"), {:contoller => 'users' , :action => 'feed'} %>
	   </div></br> 
	   <%else%>

 <div align="center">
        <h3> <%= @story.title %> </h3>
      </div>

<!--checking for media url if found with content extract it from content display and then display content without it -->

    <div align="center">
    
    <% if @story.media_link != nil && @story.media_link.length > 3%>
    <img src="<%=@story.media_link%>" width="220" align="center">
    
	<%else%>
        <% @all = "img src=" %>
	<% @url_start = "http://" %>
        <% @url_end = "\" " %>
        
    	 <% if @story.content =~ /#{@url_regex}/ %>
    	    <% @allstart = @story.content.index(@all)%>
	    <% @start = @story.content.index(@url_start)%>
    	    <% @end = @story.content.index(@url_end) %>
 	    <% @media = @story.content[	@start.to_i , @end.to_i-10] %>
  	    <% @allmedia = @story.content[@all.to_i , @end.to_i+1]%>
		<img id="toppic" src="<%=@media%>" width="220" align="center" />
	    <%end%>
       <%end%>
	 </div></br>
	
<!-- checking for story category if RSS allow story functionalties if not remove from view -->
	<% if @story.category == "RSS" %>
		<div style="padding-left:10px;">
 <!-- adding like and dislike button if user didnt like or dislike before and number of likes dislikes for this stort  -->
 <% if @action1 == [] && @action2 == [] %>

<%= link_to image_tag("http://img210.imageshack.us/img210/5599/likecopy.png" , :style =>"width:25px;height:25px;"), {:controller => 'likedislikes' , :action => 'thumb' , :sid => @story.id  , :act => 1 }%> 
 <% if @likes.length > 0 %>
<% @a = "#{@likes.length} people like this." %>
 <%=link_to(@a , {:controller => "stories", :action => "liked_mobile_show", :id => (@story.id)})%>
 <%else%>  
 <%= "thumb up"%>
 <%end%></br>
 
<%= link_to image_tag("http://img717.imageshack.us/img717/856/dislikekh.png" , :style =>"width:25px;height:25px;"), {:controller => 'likedislikes' , :action => 'thumb' , :sid => @story.id  , :act => -1}%>
  <% if @dislikes.length > 0 %>
  <% @a = "#{@dislikes.length} people dislike this." %>
  <%=link_to(@a, {:controller => "stories", :action => "disliked_mobile_show", :id => (@story.id)})%>
  <%else%>
  <%= "thumb down"%>
  <%end%>
  <%end%>
  <%end%>
  
<!-- if user liked this story before remove like button and only adds dislike button -->
  <% if @action1 != [] && @action2 == [] %>
  	<% @a = "you and #{@likes.length-1} people like this." %>
  	<% if @likes.length > 1 %>
  	 <%=link_to(@a , {:controller => "stories", :action => "liked_mobile_show", :id => (@story.id)})%>
  	 <%else%>
  	 <%= "you like this."%>
  	 <%end%>
  	 </br>
 	<%= link_to image_tag("http://img717.imageshack.us/img717/856/dislikekh.png" , :style =>"width:25px;height:25px;"), {:controller => 'likedislikes' , :action => 'thumb' , :sid => @story.id  , :act => -1}%>
  <% if @dislikes.length > 0 %>
  <% @a = "#{@dislikes.length} people dislike this." %>
  <%=link_to(@a , {:controller => 'stories', :action => 'disliked_mobile_show', :id => (@story.id)})%>
  <%else%>
  <%= "thumb down"%>
  <%end%>
  
  <%end%>
  </br>
  
  <!-- if user disliked this story before remove dislike button and only adds like button -->
  <% if @action2 != []  && @action1 == [] %>
	
	
<%= link_to image_tag("http://img210.imageshack.us/img210/5599/likecopy.png" , :style =>"width:25px;height:25px;"),{ :controller => 'likedislikes' , :action => 'thumb' , :sid => @story.id  , :act => 1}%>
	 <% if @likes.length > 0 %>
 		<% @a = "#{@likes.length} people like this." %>
 		<%=link_to(@a , {:controller => 'stories', :action => 'liked_mobile_show', :id => (@story.id)})%>
	 <%else%>
		 <%= "thumb up"%>
 	<%end%>
	</br>
	<% if @dislikes.length > 1 %>
	<% @a = "you and #{@likes.length-1} people like this." %>
  	  <%=link_to(@a , {:controller => 'stories', :action => 'disliked_mobile_show', :id => (@story.id)})%>
  	 <%else%>
  		 <%= "you dislike this."%>
  	 <%end%>
	

  <%end%>
	</br>
 
 <%end%>
 	 
<!-- adds content of story  -->
 <div class="story-comment-box-mobile pre-scrollable" style="padding-left:10px;">
 <% if @story.content != nil %>
 <%if @allmedia != nil && @allmedia.length > 4 %>
 <% @story.content.slice!(@allmedia) %>
 <%end%>
 <%= @story.content %>
 <%end%>
 </br></br>
 </div>


	<% if @story.category == "RSS" %>

<!-- recommend buttons  1) facebook button 2)twitter button 3)La2etlak button -->
  
<!--$$$$$$$$$$$$$$$$ Mina Adel $$$$$$$$$$$$$$$$ -->

   &nbsp;
<!-- I create the facebook sharer url with the media link, then I put it into the url part of the button -->
  <% facebook_url = "https://www.facebook.com/sharer/sharer.php?u="+@story.media_link%>
    <a href=<%=facebook_url%>><img src = "http://dcbdluf1ahqio.cloudfront.net/facebook/32x32.png" height="30" width="30"></a>
  <!-- I create the twitter sharer url with the media link along with the message "Shared via La2etlak Nokia App", then I put it into the url part of the button -->
	<% twitter_url = "http://twitter.com/intent/tweet?url="+@story.media_link+"&text=Shared%20via%20La2etlak%20Nokia%20App" %>
    <a href=<%=twitter_url%>><img src = "http://dcbdluf1ahqio.cloudfront.net/twitter/32x32.png" height="30" width="30"></a>
  <!-- This is a link to the share controller, which calls the method user_share_story with a the story id as a parameter -->
    <%= link_to("La2etlak" , {:controller => 'shares', :action => 'user_share_story', :id => @story.id} )%></br>
<!--$$$$$$$$$$$$$$$$ Mina Adel $$$$$$$$$$$$$$$$ -->

<!-- recommend button -->
   &nbsp;<%= link_to image_tag("http://t1.ftcdn.net/jpg/00/31/12/18/400_F_31121846_hi50PXgc8TyWvPty0xBZ8p4XqnVRalw7.jpg" , :style =>"width:35px;height:25px;"), {:controller => 'stories' , :action => 'recommend_story_mobile_show' , :sid => @story.id }%>Recommend
<!-- flag button -->
   &nbsp;<%= link_to image_tag("http://cdn1.iconfinder.com/data/icons/CrystalClear/128x128/actions/flag.png" , :style =>"width:25px;height:20px;"), {:controller => 'flags' , :action => 'flag' , :sid => @story.id }%>Flag</br>
   
<!-- Comments area, to comments and up or 
     any comments
     Author: Menisy-->
    <div style="padding-left:3px;float:left;">
    <h4> Comments </h4>
</div>
<br>
<br>
<div style="width:95%;">
    <% comments = Comment.find_all_by_story_id(@story.id) %>
    <% comments.each do |comment| %>

    <div class="story-comment-box-mobile well" style="float:left;clear:both;width:90%;margin:0.5%">
        <h5 style="padding-left:3%;padding-top:1px;">    <%= comment.user.name %> says:</h5>
        <div style="clear:both;padding:1px;">
            <a href="#" style="float:left;padding-right:5px;padding-left:3px;padding-top:10px;" align="top"> <img
                    src="http://placehold.it/50x50">
            </a>
            <div style="padding-top:10px;padding-bottom:5px;">
                <%= comment.content %>
            </div>
        </div>
        <ul class="nav">
            <% pic = nil %>
            <% if comment.downed_by_user?(current_user) then%>
                <% pic = "http://img825.imageshack.us/img825/7254/undislike.png" %>
            <% else %>
                <% pic = "http://img717.imageshack.us/img717/856/dislikekh.png" %>
            <% end %>
            <li><%= link_to (image_tag (pic)) ,{:action=> :down_comment, :user_id => params[:id2], :comment_id => comment.id}, {:style =>'float:right;margin-right:4%;width:30px;height:30px;'} %>
            </li>
            <li>
                <h8 style="color:#b94a48;float:right;margin-right:1%;padding-top:2px;"> <%= comment.get_num_downs %>
                </h8>
            </li>
            <% pic2 = nil %>
            <% if comment.upped_by_user?(current_user) then%>
                <% pic2 = "http://img585.imageshack.us/img585/9320/unlikec.png" %>
            <% else %>
                <% pic2 = "http://img210.imageshack.us/img210/5599/likecopy.png" %>
            <% end %>
            <li><%= link_to (image_tag (pic2)) ,{:action=> :up_comment, :user_id => params[:id2], :comment_id => comment.id}, {:style =>'float:right;margin-right:1%;width:30px;height:30px;padding-bottom:5px;'} %>
            </li>
            <li>
                <h8 style="color:#468847;float:right;margin-right:1%;"> <%= comment.get_num_ups %>
                </h8>
            </li>
        </ul>
    </div>
<% end %>
</div>
<div style="width:95%">
    <%= form_for(@comment) do |f| %>
    <div class="story-comment-box-mobile well" style="padding-left:3px; clear:both;width:margin:0.5%">
        <div style="margin-left:0.5%;">
            Enter a comment:
        </div>
        <%= f.text_area :content, :class => "story-textarea-mobile" %>
    </div>
    <%= f.hidden_field :user_id, :value => @user.id %>
    <%= f.hidden_field :story_id, :value => @story.id %>
    <div class="actions" style="padding:20px;float:right;">
        <%= f.submit "comment" ,:class => "btn btn-large" %>
        <% end %>
    </div>
</div>
 
 
 
 <% if @user.user_interests != [] %> 
 
 
<!-- block story story -->
   	<%=link_to('Block story' , {:controller => 'users', :action => 'block_story', :id => (@story.id)})%> &nbsp;
   	
<!-- block interest link -->
   	<%=link_to('Block interest' , { :controller => 'users', :action => 'block_interest', :id => (@story.id)})%></br>
   	
   	<%end%>
   	
<!-- when was the story added to our system -->
	Added on <%= @story.created_at %></br></br>
	

	
	<%end%>
	
	<!-- back to main feed button -->
	<div align="center">
			   <%= link_to image_tag("http://icons.iconarchive.com/icons/dryicons/simplistica/128/back-icon.png" , :style =>"width:50px;height:30px;"), {:controller => 'users', :action => 'feed'} %>
	   </div></br> 
 </div>
   
</html> 	

